/*
 * generated by Xtext 2.38.0
 */
package org.xtext.shibainu.validation;

import java.util.HashSet;
import java.util.Set;

import org.eclipse.xtext.validation.Check;
import org.xtext.shibainu.shibainu.Comparison;
import org.xtext.shibainu.shibainu.Conditional;
import org.xtext.shibainu.shibainu.Model;
import org.xtext.shibainu.shibainu.ShibainuPackage;
import org.xtext.shibainu.shibainu.Statement;
import org.xtext.shibainu.shibainu.VariableDeclaration;

/**
 * This class contains custom validation rules. 
 *
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#validation
 */
public class ShibainuValidator extends AbstractShibainuValidator {
	
	@Check
    public void checkModelo(Model model) {
        Set<String> declaradas = new HashSet<>();

        for (Statement stmt : model.getStatements()) {
            if (stmt instanceof VariableDeclaration decl) {
                String nombre = decl.getName();

                if (declaradas.contains(nombre)) {
                    error("Variable '" + nombre + "' ya fue declarada",
                          decl,
                          ShibainuPackage.Literals.VARIABLE_DECLARATION__NAME);
                } else {
                    declaradas.add(nombre);
                }

            } else if (stmt instanceof Conditional cond) {
                Comparison comp = cond.getComparison();
                String varUsada = comp.getLeft();

                if (!declaradas.contains(varUsada)) {
                    error("La variable '" + varUsada + "' no fue declarada",
                          comp,
                          ShibainuPackage.Literals.COMPARISON__LEFT);
                }
            }
        }
    }
	
}
